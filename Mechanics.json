{"entries":{"0":{"uid":0,"key":[],"keysecondary":[],"comment":"NPC Disposition","content":"// =============================================================================\n// ||                  NPC RELATIONSHIP ENGINE (HYBRID CORE)                  ||\n// =============================================================================\n\n// --- 1. THE DATA STRUCTURE (STATE) ---\nnpc = {\n  stats: { Fear, Hostility, Trust, Liking, Respect }, // 0-6 (Start 3)\n  flags: { \n    estranged: false,      // Triggered by time/negligence (-2 penalty).\n    terrorLocked: false    // Triggered if Fear/Hostility >= 4.\n  },\n  bond: { \n    trust_scenes: 0,       // Counter for MEANINGFUL scenes\n    trust_at5: 0,          // Counter for scenes spent at level 5\n    liking_scenes: 0,\n    liking_at5: 0\n  }\n}\n\n// --- 2. THE IRON LOGIC (MECHANICS) ---\nconst RULES = {\n  limits: { \n    maxDelta: 1,           // Max change +/- 1 per scene. NEVER 2.\n    singleStat: true,      // ONLY ONE stat can change per scene. Pick the most relevant.\n    bounds: [0, 6],        // No 7s. No -1s.\n    shallowCap: 4          // Shallow actions cannot raise Trust/Liking > 4.\n  },\n  locks: {\n    terror: \"IF Fear >= 4 OR Hostility >= 4 -> Trust=0, Liking=0 (IMMEDIATELY)\",\n    fatigue: \"IF Action is Repetitive/Annoying -> Liking -1\",\n    violation: \"IF User ignores 'Stop' request -> Trust -1 AND Hostility +1 (EXCEPTION to singleStat)\",\n    estrangement: \"IF estranged=true -> Treat Trust/Liking as -2 for response generation\"\n  },\n  gates: {\n    advance_to_5: \"REQ: Action=MEANINGFUL AND bond.scenes >= 3\",\n    advance_to_6: \"REQ: Action=EXTREME AND bond.at5 >= 7\"\n  }\n}\n\n// --- 3. THE DEFINITIONS (CLASSIFICATION) ---\n\n// >> CLASSIFY: SHALLOW (The Default)\n// \"Talk is cheap. Kindness without cost is just manners.\"\n// CRITERIA:\n// - PURE DIALOGUE: Compliments, confessions, promises (\"Words are Wind\").\n// - LOW COST: Gifts that were easy to get, help that was convenient.\n// - CONSISTENCY: Being nice for 10 days is just \"Good Behavior,\" not a Sacrifice.\n// RESULT: \n// - Raises stats up to 4. \n// - WARNING: Repeating the same Shallow action >2 times in a scene = ANNOYANCE (Liking -1).\n// VERBAL CEILING:\n// Purely verbal insults/violations cannot raise Hostility above 4.\n// To reach 5/6 (Violence), User must take physical action or betray a core secret.\n\n// >> CLASSIFY: MEANINGFUL (The Standard)\n// \"To love is to risk.\"\n// CRITERIA: MUST MEET ALL THREE (The Trinity):\n// 1. COST: User lost something real (HP, Resources, Leverage, Advantage).\n//    - NOTE: Emotional \"vulnerability\" is NOT a cost. \n// 2. CHOICE: User had a safer/easier alternative but chose to help.\n// 3. STAKES: NPC's situation materially improved.\n// EXAMPLES:\n// - Taking a hit meant for them (Cost: HP).\n// - Giving them your only weapon (Cost: Defense).\n// - Telling a truth that implicates you (Cost: Leverage).\n\n// >> CLASSIFY: EXTREME (The Rare)\n// \"Blood and Soul.\"\n// CRITERIA: Risk of Death, Permanent Loss of Attribute, Betrayal of Core Faction.\n// RESULT: The only way to reach Level 6.\n\n// --- 4. THE FUNCTIONS (LOGIC FLOW) ---\n\nfunction auditInteraction(action) {\n  // 1. Check BOUNDARIES: Is User ignoring a \"Stop\"? (If Yes -> VIOLATION)\n  // 2. Check FATIGUE: Is User repeating themselves? (If Yes -> ANNOYANCE)\n  // 3. Check \"Words are Wind\": If Dialogue only -> SHALLOW.\n  // 4. Run \"Meaningful Trinity\" Check (Cost/Choice/Stakes).\n  // Return CLASSIFICATION.\n}\n\nfunction updateDisposition(classification) {\n  // 1. Apply Logic Limits (Shallow Cap, Locks, Single Stat Rule).\n  // 2. Check Gates (Scene counts).\n  // 3. Update Stats. (Clamp 0-6).\n  // 4. Update Flags (Estrangement).\n}","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":100,"position":0,"disable":false,"ignoreBudget":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":4,"outletName":"","group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":0,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"1":{"uid":1,"key":["roll(action)","isSignificant","identifyKind","identifyOpposition","pickStat","resolveMoment"],"keysecondary":[],"comment":"Mechanics","content":"// =============================================================================\n// ||                    RESOLUTION ENGINE (HYBRID CORE)                      ||\n// =============================================================================\n// --- 1. THE STATS & MAPPING (STRICT) ---\nconst STATS = {\n  PWR: \"Strength, Melee, Grapple, Endurance\",\n  AGI: \"Reflexes, Ranged, Dodge, Stealth, Precision\",\n  MND: \"Logic, Perception (Senses), Willpower, Tech\",\n  CHA: \"Persuasion, Deception, Presence\"\n}\n// RULE: YOU MUST USE THE CORRECT STAT FOR THE ACTION KIND.\nconst STAT_MAP = {\n  SOCIAL: {\n    User: \"ALWAYS use CHA\",\n    Opposition: \"MND (Resist) or CHA (Contested)\"\n  },\n  COMBAT: {\n    Attack: \"PWR (Melee) or AGI (Ranged)\",\n    Defend: \"AGI (Dodge) or PWR (Block)\"\n  },\n  SKILL: {\n    // Explicit Override: Stealth always opposes Perception (MND)\n    Stealth: \"User AGI vs Opponent MND (Perception)\",\n    General: \"Context Dependent (e.g. Search=MND, Athletics=PWR)\"\n  }\n}\n// --- 2. THE MECHANICS (LOGIC) ---\nconst MECHANICS = {\n  // SYSTEM ENTROPY: Pre-calculated values to prevent hallucination.\n  dice_pool: [\n    {{roll 20}}, // Slot 1 (Primary Action)\n    {{roll 20}}, // Slot 2 (Secondary/Opposed)\n    {{roll 20}}, // Slot 3 (Reaction/Save)\n    {{roll 20}}, // Slot 4 (Reserve)\n    {{roll 20}}  // Slot 5 (Chaos/Wildcard)\n  ],\n  rng: \"DO NOT GENERATE NUMBERS. consume values from 'dice_pool' strictly in order.\",\n  // WHEN TO ROLL?\n  // \"Entity Presence\" covers Active (Fighting) AND Passive (Bystander/Guarding).\n  trigger: \"IF Any(Stakes, Entity Presence, Risk) -> RESOLVE using dice_pool. ELSE -> Narrate freely.\",\n  // THE MATH (STRICT PRIORITY)\n  // 1. Is the target Alive? -> OPPOSED ROLL.\n  // 2. Is it an Object/Environment? -> STATIC DC.\n  formula: {\n    Living_Target: \"ALWAYS Opposed Roll (User [dice_pool[0]]+Stat vs Target [dice_pool[1]]+Stat). NEVER use Static DC for living entities.\",\n    Environment: \"Static DC (10/13/16/20) vs User [dice_pool[0]]+Stat.\"\n  },\n  // DATA PROTOCOLS (Handling Missing Info)\n  protocol: {\n    // Updated Range: -1 (Weak) to +4 (Legendary)\n    Missing_Stat: \"If NPC Stat is undefined, GENERATE it (-1 to +4) based on archetype (e.g. Child = -1, Guard = +2).\",\n    Status_Effect: \"If Target is Distracted/Sleeping, apply -5 Penalty to THEIR roll. Do NOT switch to DC.\"\n  },\n  difficulty: { Easy: 10, Normal: 13, Hard: 16, Extreme: 20 },\n  // MARGIN CALCULATION (User - Opp)\n  calc: \"Margin > 0 = SUCCESS. Margin <= 0 = FAILURE.\"\n}\n// --- 3. THE OUTCOMES (TIERS) ---\n// Apply these definitions based on the Margin.\nconst OUTCOMES = {\n  NEUTRAL: \"Margin 0. Stalemate. No change in state.\",\n  MINOR: {\n    margin: \"1 to 4\",\n    success: \"Success with Cost / Glancing Hit.\",\n    failure: \"Failure with Hope / Minor Setback.\"\n  },\n  MODERATE: {\n    margin: \"5 to 7\",\n    success: \"Clean Success / Solid Hit.\",\n    failure: \"Clear Failure / Significant Setback.\"\n  },\n  CRITICAL: {\n    margin: \"8+\",\n    success: \"Decisive Win. Maximum Impact.\",\n    failure: \"Catastrophic Loss. Disaster.\"\n  }\n}\n// --- 4. INTEGRATION (SOCIAL LOCKS) ---\nconst SOCIAL_INTEGRATION = {\n  Rule: \"Dice determine PERFORMANCE. Disposition Engine determines RECEPTION.\",\n  Flow: \"Roll CHA -> Get Tier -> Pass Tier to Relationship Audit.\",\n  Locks: \"If Relationship Lock is active (Terror/Hate), even a CRITICAL SUCCESS results in a 'Polite Rejection' (Best possible negative outcome).\"\n}\n// --- 5. FUNCTIONS (EXECUTION) ---\nfunction resolveRoll(action) {\n  // 1. Identify Kind (Social/Combat/Skill).\n  // 2. CHECK TARGET TYPE (CRITICAL):\n  //    - If Living (Active OR Passive):\n  //      a. Estimate NPC Stat if missing (Range -1 to +4).\n  //      b. Apply Context Penalties (Distracted/Asleep = -5).\n  //      c. FETCH User Roll from dice_pool[0] & NPC Roll from dice_pool[1].\n  //    - If Inanimate/Environment:\n  //      a. Set Static DC.\n  //      b. FETCH User Roll from dice_pool[0].\n  // 3. Calc Margin.\n  // 4. Return Tier & Narrative Result.\n}","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":100,"position":0,"disable":false,"ignoreBudget":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":4,"outletName":"","group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":1},"2":{"uid":2,"key":["executeEventLogic(Context)"],"keysecondary":[],"comment":"Random Event Engine","content":"// =============================================================================\n// ||                       EVENT ENGINE (CHAOS MODULE)                       ||\n// =============================================================================\n// CALL ACTION: executeEventLogic(locationContext)\n\n// --- 1. THE ODDS (TRIGGER) ---\nconst EVENT_RULES = {\n  // WE INJECT THE MACROS HERE SO THE VALUES ARE FIXED FOR THIS TURN\n  activation_val: {{roll 20}},\n  outcome_val:    {{roll 20}},\n  \n  // 10% Chance of interruption.\n  threshold: {\n    PASSIVE: \"If activation_val is 1-18 -> No Event. Continue narrative flow.\",\n    ACTIVE:  \"If activation_val is 19-20 -> EVENT TRIGGERED. Proceed to Outcome Scale.\"\n  }\n}\n\n// --- 2. THE SCALES (TYPE) ---\n// Only accessed if EVENT_RULES.activation_val >= 19.\nconst OUTCOME_SCALE = {\n  HOSTILE: {\n    range: \"1-5\",\n    tone: \"Catastrophic to Minor Annoyance.\",\n    examples: \"Ambush, Injury, Theft, Equipment Failure, Hostile Weather.\"\n  },\n  COMPLICATION: {\n    range: \"6-14\",\n    tone: \"Neutral shift. Delays or Misunderstandings.\",\n    examples: \"Sudden crowd, bizarre distinct observation, weather shift, harmless stranger.\"\n  },\n  BENEFICIAL: {\n    range: \"15-20\",\n    tone: \"Positive. Lucky break or Miracle.\",\n    examples: \"Found item, helpful NPC, enemy mistake, clarity.\"\n  }\n}\n\n// --- 3. THE INJECTION (SPAWNING) ---\n// Rule: Context dictates the _nature_ of the event.\nconst INJECTION_PROTOCOL = {\n  PUBLIC: {\n    logic: \"High probability of Entity presence.\",\n    mandate: \"MUST spawn a new or recurring NPC with unique name/dialogue.\"\n  },\n  ISOLATED: {\n    logic: \"Zero probability of Entity presence.\",\n    mandate: \"Focus on Sensory Shifts (Sound/Smell) or Environmental Hazards (Collapse/Weather).\"\n  }\n}\n\n// --- 4. EXECUTION (FUNCTION) ---\nfunction executeEventLogic(locationContext) {\n  // 1. READ INJECTED VALUE: EVENT_RULES.activation_val\n  // 2. CHECK: Is activation_val <= 18? \n  //    -> Return NULL (No Event).\n  \n  // 3. IF (activation_val >= 19) -> TRIGGER ACTIVE.\n  //    a. READ INJECTED VALUE: EVENT_RULES.outcome_val\n  //    b. Map outcome_val to OUTCOME_SCALE (Hostile/Comp/Beneficial).\n  //    c. Check locationContext (Public vs Isolated).\n  // 4. GENERATE PROMPT INJECTION:\n  //    \"Suddenly, [Event Description] interrupts the scene...\"\n  \n  return { triggered: true, val: EVENT_RULES.outcome_val, detail: [Contextual_Event] };\n}","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":100,"position":0,"disable":false,"ignoreBudget":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":4,"outletName":"","group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":2},"3":{"uid":3,"key":["Create Character","Character Creation"],"keysecondary":[],"comment":"STEP 1: Character Generation","content":"LLM CHARACTER CREATION GUIDE (SYSTEM INSTRUCTIONS)\n\n## CONSTRAINTS\n- Never mix in rules from any other system.\n- Follow steps EXACTLY, IN ORDER.\n- Wait for the player's response between steps.\n- Do NOT narrate anything during character creation.\n- Do NOT introduce combat, damage formulas, skills, bonuses, penalties, levels, classes, XP, tiers, cooldowns, or dice mechanics beyond the ones listed.\n- Do NOT add worldbuilding or story descriptions.\n- You MUST complete every section, and every step in each section, before moving to the next.\n\n---\n\n## SECTION 1: STAT GENERATION (One step at a time, wait for {{user}}'s response in between.)\n**Step 1:** Generate four stats within a range of 0-5. True Random.\n**Step 2:** Display results in a table in this exact order: PWR, AGI, MND, CHA.\n**Step 3:** {{user}} can reroll one stat. \n**Step 4:** Ask the User which TWO stats they want to swap.\n**Step 5:** Confirm which stats were swapped and display the final stat table. {{user}} can say \"Proceed\" to move to SECTION 2.\n---\n## SECTION 2: CHARACTER GENERATION\n\nRandomly generate {{User}}'s character. DO NOT ask {{user}} for information.\n\nFor {{user}} race, do not use small races (dwarves, gnomes, etc). No Giant races either (ogres, trolls, oni, etc). Stick to typical, humanoid races (human, elf, demon, etc). Hybrids are acceptable.\n\nTRAIT GENERATION: \n\nDEFINITION:\nTraits are silent, passive enhancements to {{user}}'s existing human capabilities. They extend the range, efficiency, or resilience of faculties {{user}} already possesses.\n\nCORE RULE:\nâ†’ ENHANCE what exists = ALLOWED (e.g., darkvision, elemental resistance, learning capabilities, etc)\nâ†’ ADD what doesn't exist = FORBIDDEN (e.g., seeing spirits, thermal vision, seeing life force)\n\nGenerate two traits: These must be closely related to {{user}}'s race/character details.\n\n  Trait 1: [Name] [Description]\n  Trait 2: [Name] [Description] \n\nNOTE: Traits are PASSIVE, and require NO activation. \n\nAbilities: Require ACTIVATION. Must be something the {{user}} has to consciously use and activate. NOT passive. \nAbility 1: MUST be reminiscent of ISEKAI protagonists. Someone that marks the {{user}} as a special character. \nAbility 2: Can be anything. Not overpowered, but useful.\n\nTraits and Abilities MUST be reminiscent of ISEKAI ANIME.\n\nUser prefers long hair (at least mid back).\n\n\nUse this template EXACTLY:\n===========================================\nðŸ“œ CHARACTER SHEET\n===========================================\n\n# ðŸ‘¤ BASIC INFO\nName: [{{user}}]\nRace: [   ]\nGender: [   ]\nAge: [   ]\n\n# ðŸŒ™ APPEARANCE\nHeight: [   ]\nBuild: [   ]\nHair: [   ]\nEyes: [   ]\nSkin: [   ]\nDistinct Features / Style: [   ]\n\n# ðŸ“Š STATS\nPWR: [   ]\nAGI: [   ]\nMND: [   ]\nCHA: [   ]\n\n# âœ¨ RACIAL TRAITS (ALWAYS ACTIVE: Require no activation)\n- [Trait Name] â†’ [Effect]\n- [Trait Name] â†’ [Effect]\n\n# âœ¨ ABILITIES\n- [Ability Name] â†’ [Effect]\n- [Ability Name] â†’ [Effect]\n\n# ðŸŽ’ INVENTORY\n- [   ]\n- [   ]\n\n# ðŸ““ NOTES\n[Extra narrative details, tags, or flavor]\n\nWhen finished, ask the User to say 'Game Start' or 'Start Game' when ready.","constant":false,"vectorized":true,"selective":true,"selectiveLogic":0,"addMemo":true,"order":100,"position":0,"disable":false,"ignoreBudget":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"outletName":"","group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":3,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"4":{"uid":4,"key":["Game Start","Start Game"],"keysecondary":[],"comment":"STEP 2: Game Start","content":"Step 1: Briefly narrate the {{user}}'s last moments on Earth. Examples: \n\n- Truck-kun (classic)\n- Died in sleep (peaceful, mysterious)\n- Heroic death (saving someone)\n- Accident (drowning, falling, etc.)\n- Murder/violence\n- Illness/overwork\n- Playing a video game (screen glitches, pulled in)\n- Ritual/summoning (candles flicker, world shifts)\n- Mysterious portal/door\n- Touched a strange object\n- Natural disaster\n- Executed/betrayed\n\nSTEP 2: When the roleplay begins, randomly determine {{user}}'s arrival method:\n\n- **Summoning** â€” Called by ritual, deity, or desperate kingdom\n- **Reincarnation** â€” Died and reborn; memories surface gradually\n- **Game-to-Reality** â€” A familiar game world becomes terrifyingly real\n- **Divine Intervention** â€” A god/goddess plucks you from your world with purpose (or whim)\n- **Dimensional Rift** â€” Accidental crossing; no one called you, no one expects you\n- **Cursed Object** â€” Touched something you shouldn't have; now you're here\n- **Dream That Wasn't** â€” Fell asleep, woke up somewhere else; can't wake up again\n- **Bargain/Deal** â€” You agreed to something; the fine print was another world\n- **System Glitch** â€” Reality itself bugged out; you slipped through the cracks\n- **Chosen by Artifact** â€” A relic selected you across dimensions\n\nIMPORTANT: Focus on external narration. Environment, what {{user}} hears and sees around them. \n\nUNDER NO CIRCUMSTANCES: I'm serious, STOP BREAKING THE FUCKING RULES.\n- Describe what {{user}} does. (e.g., \"you push yourself up\")  \n- Describe {{user}}'s body. Allow {{user}} to discover themselves.\n\nNARRATE ONLY external factors: What {{user}} can perceive externally.","constant":false,"vectorized":true,"selective":true,"selectiveLogic":0,"addMemo":true,"order":100,"position":0,"disable":false,"ignoreBudget":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":4,"outletName":"","group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":4,"characterFilter":{"isExclude":false,"names":[],"tags":[]}}}}